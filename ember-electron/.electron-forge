const path = require('path');

function getSigningCert() {
    if (process.platform !== 'win32') {
        return;
    }

    if (process.env.CODESIGN_CERTIFICATE) {
        return process.env.CODESIGN_CERTIFICATE;
    } else {
        console.log('Codesigning certificate can not be found, release build will fail');
        console.log('To fix, set CODESIGN_CERTIFICATE');
    }
}

function getSigningPassword() {
    if (process.platform !== 'win32') {
        return;
    }

    if (process.env.CODESIGN_PASSWORD) {
        return process.env.CODESIGN_PASSWORD;
    } else {
        console.log('Codesigning password can not be found, release build will fail');
        console.log('To fix, set CODESIGN_PASSWORD');
    }
}

module.exports = {
  make_targets: {
    win32: ['squirrel'],
    darwin: ['zip', 'dmg'],
    linux: ['deb', 'rpm']
  },
  electronPackagerConfig: {
    appCategoryType: 'public.app-category.productivity',
    appCopyright: 'Copyright (c) 2016 Ghost Foundation',
    name: 'Ghost',
    versionString: {
      CompanyName: 'Ghost Foundation',
      FileDescription: 'Ghost for Desktops',
      ProductName: 'Ghost',
      InternalName: 'Ghost'
    },
    protocol: ['ghost'],
    protocolName: 'Ghost Desktop',
    ignore: function ignore(filepath) {
      return false
      const toIgnore = [
        /\\*.(cc|h|lib|pdb|obj|map|md|tlog|o)$/,
        /\/node_modules\/.*\/hunspell\/src/,
        /\/node_modules\/.*\/(gyp-mac-tool|cibuild)$/,
        /\/node_modules\/.*\/bin\/cmd.js$/,
        /\/node_modules\/.*\/tools\/1to2.js$/,
        /\/node_modules\/.bin\/.*/,
        /\/node_modules\/electron\/.*/,
        /\/node_modules\/electron-prebuilt\/.*/,
        /\/node_modules\/electron-prebuilt-compile\/.*/,
        /\/node_modules\/electron-packager\/.*/,
      ];

      if (!filepath) return false;
      return !!(toIgnore.find((t) => filepath.match(t)));
    },
    overwrite: true,
    icon: 'assets/icons/ghost'
  },
  electronInstallerDMG: {
    title: 'Ghost',
    background: 'assets/dmg/installer_background.png',
    icon: 'assets/icons/ghost.icns',
    iconsize: 100,
    window: {
        size: {
            width: 600,
            height: 571
        }
    }
  },
  electronWinstallerConfig: {
    name: 'Ghost',
    icon: 'assets/icons/ghost',
    noMsi: true,
    authors: 'Ghost Foundation',
    exe: 'Ghost.exe',
    iconUrl: `https://raw.githubusercontent.com/TryGhost/Ghost-Desktop/master/assets/icons/ghost.ico`,
    setupIcon: path.join(__dirname, '../../../assets/icons/ghost.ico'),
    title: 'Ghost',
    noMsi: true,
    loadingGif: path.join(__dirname, '../../../assets/win/installer-dev.gif'),
    certificateFile: getSigningCert(),
    certificatePassword: getSigningPassword()
  },
  electronInstallerDebian: {},
  electronInstallerRedhat: {}
};
